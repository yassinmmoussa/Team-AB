<<<<<<< HEAD
import { appendContextPath, blockParams, createFrame, isEmpty, isFunction } from '../utils';
=======
import {
  appendContextPath,
  blockParams,
  createFrame,
  isEmpty,
  isFunction
} from '../utils';
>>>>>>> 0ae1a948acc774b725d2813ed0b826c52e048967
import Exception from '../exception';

export default function(instance) {
  instance.registerHelper('with', function(context, options) {
<<<<<<< HEAD
    if (arguments.length != 2) { throw new Exception('#with requires exactly one argument');}
    if (isFunction(context)) { context = context.call(this); }
=======
    if (arguments.length != 2) {
      throw new Exception('#with requires exactly one argument');
    }
    if (isFunction(context)) {
      context = context.call(this);
    }
>>>>>>> 0ae1a948acc774b725d2813ed0b826c52e048967

    let fn = options.fn;

    if (!isEmpty(context)) {
      let data = options.data;
      if (options.data && options.ids) {
        data = createFrame(options.data);
<<<<<<< HEAD
        data.contextPath = appendContextPath(options.data.contextPath, options.ids[0]);
=======
        data.contextPath = appendContextPath(
          options.data.contextPath,
          options.ids[0]
        );
>>>>>>> 0ae1a948acc774b725d2813ed0b826c52e048967
      }

      return fn(context, {
        data: data,
        blockParams: blockParams([context], [data && data.contextPath])
      });
    } else {
      return options.inverse(this);
    }
  });
}
